<html>
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <title>FSR :: Functions (Flexible Statistics Data Analysis Toolbox™)</title>
  <link href="docstyle.css" rel="stylesheet" type="text/css">
  <meta content="refpage" name="chunktype">
  <meta content="function:FSR" name="refentity">
  <meta content="text/javascript" http-equiv="Content-Script-Type">
  <meta content="fcn" name="toctype">
  <script type="text/javascript" language="javaScript" src="bottom.js">
  </script>
</head>

<body>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<!--FScategory:Robust Regression Analysis and transformations-->
<a name="top_of_page"></a> 

<p style="font-size: 1px;"> </p>

<table border="0" cellpadding="0" cellspacing="0" class="nav"
summary="Navigation aid" width="100%">
  <tbody>
    <tr>
      <td valign="baseline"><b>Flexible Statistics Data Analysis
      Toolbox™</b></td>
      <td align="right" valign="baseline"><a href="fsmtra.html"><img
        align="bottom" alt="fsmtra" border="0"
        src="images_help/b_prev.gif"></a>   <a href="fsraddt.html"><img
        align="bottom" alt="FSRaddt" border="0"
        src="images_help/b_next.gif"></a></td>
    </tr>
  </tbody>
</table>

<a name="bq24of9-1"></a><a class="indexterm" name="zmw57dd0e69698"></a> 

<h1 class="reftitle">FSR</h1>

<p class="purpose">Automatic Outlier Detection Procedure based on Forward
Search Estimator </p>

<h2>Syntax </h2>

<p class="synopsis"><tt>[out] = FSR(y,X)<br>
[out] =
FSR(y,X,</tt><tt><i>param1</i></tt><tt>,</tt><tt><i>val1</i><tt>,</tt><i>param2</i><tt>,</tt><i>val2</i><tt>,...)<br>
</tt> </tt></p>
<a name="f4811966"></a> 

<h2>Description </h2>

<p><tt>FSR(y,X)</tt> gives in structure out a set of units which can be
considered atypical. To detect outliers all methods compare selected residuals
with a threshold. We examine the minimum deletion residual
(<em>r</em><sub>min</sub>) among observations that are not in the subset (say
of size <em>m</em>). If this ordered observation [m+1] is an outlier relative
to the other m observations, this residual will be "large" compared with the
maximum residual of observations in the subset. In uncalibrated use of the
minimum deletion residual to detect outliers the decision whether a difference
in distances is "large" is subjective, without reference to any null
distribution. To calibrate the forward search and so to provide an objective
basis for decisions about the number of outliers in a sample we have found the
distribution of the minimum deletion residual in the forward search. The output
is a series of theoretical simultaneous confidence bands (envelopes) associated
to the quantiles of the distribution of the minimum deletion residual. Finally
we have tried to calibrate the complete search in order to provide an outlier
test of ascertainable properties. </p>

<p>To use the envelopes in the forward search for outlier detection we
accordingly propose a two-stage process. In the first stage we run a search on
the data, monitoring the bounds for all n observations until we obtain a
"signal" indicating that observation m<sup>†</sup> therefore succeeding
observations, may be outliers, because the value of the statistic lies beyond
our threshold. In the second part we superimpose envelopes for values of n from
this point until the first time that we introduce an observation we recognize
as an outlier. The envelopes of minimum deletion residual outside subset
consist roughly of two parts; a flat "central" part and a steeply curving
"final" part. Our procedure FSR for the detection of a signal takes account of
these two parts. </p>

<h4>Detection of a Signal </h4>

<p>Because we potentially make many comparisons, one for each value of m, the
form of our threshold needs to allow for simultaneity, so that we have a test
with size α for the presence of at least one outlier. In order to keep into
account simultaneity we envisage four conditions, the fulfillment of any one of
which leads to the detection of a signal. </p>

<p>In the central part of the search we require 3 consecutive values of (m,n)
above the 99.99% envelope or 1 above 99.999%; <br>
In the final part of the search we need two consecutive values of
<em>r</em><sub>min</sub>(m,n) above 99.9% and 1 above 99%; <br>
<em>r</em><sub>min</sub>(n-2,n)&gt;99.9% envelope; <br>
<em>r</em><sub>min</sub>(n-1,n)&gt;99% envelope. In this last case a single
outlier is detected and the procedure terminates. </p>

<p>The final part of the search is defined as: m &gt;= n-[
13,(n/200)<sup>0.5</sup>], </p>

<p></p>

<h4>Identification of Outliers</h4>

<p>Once a signal has been found we start superimposing 99% envelopes taking
n*=m<sup>†</sup>-1, m<sup>†</sup>, m<sup>†</sup>+1, ... until the final,
penultimate or antepenultimate value are above the 99% threshold or,
alternatively, we have a value of <em>r</em><sub>min</sub>(m,n*) for any
m&gt;m<sup>†</sup> which is greater than the 99.9% threshold. </p>

<p><tt>y</tt> is a vector of length n containing the response values, while
<tt>X</tt> is the <i>n</i>-by-<i>p-1</i> matrix which contains (in the columns)
the values of <i>p-1</i> predictive terms</p>

<p><tt>[out] = FSR(y,X)</tt> returns the following information </p>
<ul type="disc">
  <li><tt>out</tt> − A structure of additional statistics with the following
    fields. 
    <ul type="circle">
      <li><p><tt>ListOut</tt> − <tt>k</tt>-by-1 vector containing the list of
        the units declared as outliers or NaN if the sample is considered
        homogeneous </p>
      </li>
      <li>beta − p-by-1 vector containing the estimated regression
      parameter.</li>
      <li><p><tt>mdr</tt> − <tt>n-init</tt>-by-2 matrix. <br>
        1st col = fwd search index<br>
        2nd col = value of minimum deletion residual in each step of the fwd
        search</p>
      </li>
      <li><p><tt>Un</tt> − <tt>(n-init)</tt>-by-11 matrix which contains the
        unit(s) included in the subset at each step of the fwd search. <br>
        REMARK: in every step the new subset is compared with the old subset.
        Un contains the unit(s) present in the new subset but not in the old
        one.<br>
        Un(1,2) for example contains the unit included in step init+1.<br>
        Un(end,2) contains the units included in the final step of the
        search.</p>
      </li>
      <li><p><tt>nout</tt> − 2 x 5 matrix containing the number of times
        observed minimum deletion residual went out of particular quantiles.<br>
        First row contains quantiles 1%, 99%, 99.9%, 99.99% and 99.999%. <br>
        Second row contains the counts of the exceedances </p>
      </li>
      <li><tt>constr</tt> − r x 1 vector. this output is produced only if the
        search found at a certain step a non singular matrix X. In this case
        the search run in a constrained mode, that is including the units which
        produced a singular matrix in the last n-constr steps. out.constr is a
        vector which contains the list of units which produced a singular X
        matrix </li>
    </ul>
    <ul>
      <a name="zmw57dd0e69798"></a> 

      <table border="1" cellpadding="5" cellspacing="0" class="note"
      summary="Note">
        <tbody>
          <tr>
            <td><p><b>Note</b>   <tt>FSR</tt> automatically includes a
              constant term in all models. Do not enter a column of 1s directly
              into <tt>X</tt>.</p>
            </td>
          </tr>
        </tbody>
      </table>
    </ul>
  </li>
</ul>

<p></p>

<p><tt>[out] =
FSR(y,X,</tt><tt><i>param1</i></tt><tt>,</tt><tt><i>val1</i><tt>,</tt><i>param2</i><tt>,</tt><i>val2</i><tt>,...)</tt></tt>
specifies one or more of the name/value pairs described in the following
table.</p>

<table border="2" cellpadding="4" cellspacing="0" class="body">
  <colgroup><col width="21%">
    <col width="79%">
  </colgroup>
  <thead>
    <tr valign="top">
      <th bgcolor="#B2B2B2">Parameter</th>
      <th bgcolor="#B2B2B2">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr valign="top">
      <td bgcolor="#F2F2F2"><tt>'intercept'</tt></td>
      <td bgcolor="#F2F2F2"><p>If 1, a model with constant term will be fitted
        (default) else no constant term will be included. </p>
      </td>
    </tr>
    <tr valign="top">
      <td bgcolor="#F2F2F2" style="height: 54px"><tt>'h'</tt></td>
      <td bgcolor="#F2F2F2" style="height: 54px"><p>The number of observations
        that have determined the least trimmed squares estimator. <tt>h</tt>
        generally is an integer greater or equal than
        <tt>[(n+size(X,2)+1)/2]</tt> but smaller then n.</p>
      </td>
    </tr>
    <tr valign="top">
      <td bgcolor="#F2F2F2"><tt>'nsamp'</tt></td>
      <td bgcolor="#F2F2F2"><p>Number of subsamples which will be extracted to
        find the robust estimator. If <tt>nsamp=0</tt> all subsets will be
        extracted. They will be <tt>(n choose p)</tt>. Remark: if the number of
        all possible subset is smaller than 1000 the default is to extract all
        subsets otherwise just 1000.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'lms'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar or structure. If <tt>lms</tt> is a scalar
        = 1 (default) Least Median of Squares is computed,<br>
        else if <tt>lms</tt> is a scalar = 2 fast lts with the all default
        options is used <br>
        else if <tt>lms</tt> is a scalar different from 1 and 2 standard lts is
        used (without concentration steps) <br>
        If <tt>lms</tt> is a struct fast lts (with concentration steps) is
        used. In this case the user can control the following options<br>
        <tt>lms.refsteps</tt> : scalar defining number of refining iterations
        in each subsample (default = 3). refsteps = 0 means "raw-subsampling"
        without iterations.<br>
        <tt>lms.reftol</tt> : scalar. Default value of tolerance for the
        refining steps The default value is 1e-6; <br>
        <tt>lms.bestr</tt> : scalar defining number of "best betas" to remember
        from the subsamples. These will be later iterated until convergence
        (default=5) <br>
        <tt>lms.refstepsbestr</tt>: scalar defining number of refining
        iterations for each best subset (default = 50). <br>
        <tt>lms.reftolbestr</tt> : scalar. Default value of tolerance for the
        refining steps for each of the best subsets The default value is 1e-8;
        <br>
        </p>
      </td>
    </tr>
    <tr valign="top">
      <td bgcolor="#F2F2F2"><tt>'plots'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar. If plots=1 (default) the plot of minimum
        deletion residual with envelopes based on n observations and the
        scatterplot matrix with the outliers highlighted is produced.<br>
        If plots=2 the user can also monitor the intermediate plots based on
        envelope superimposition. <br>
        else no plot is produced. </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'init'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar which specifies the initial subset size
        to start monitoring exceedances, if init is not specified it will be
        set equal to <br>
        <tt>p+1</tt>, if the sample size is smaller than 40; <br>
        <tt>min(3*p+1,floor(0.5*(n+p+1)))</tt>, otherwise.</p>
      </td>
    </tr>
    <tr valign="top">
      <td bgcolor="#F2F2F2"><tt>'exact'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar, if it is equal to 1 the calculation of
        the quantiles of the T and F distribution is based on functions
        <tt>finv</tt> and <tt>tinv</tt> from the Matlab statistics toolbox,
        else the calculations of the former quantiles is based on functions
        <tt>invcdff</tt> and <tt>invcdft</tt>. The solution has a tolerance of
        1e-8 (change variable tol in files invcdff.m and invcdft.m if
        required).<br>
        Remark: the use of functions tinv and finv is more precise but requires
        more time.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2" style="height: 32px"><tt>'nocheck'</tt></td>
      <td bgcolor="#F2F2F2" style="height: 32px"><p>Scalar. If nocheck is equal
        to 1 no check is performed on matrix <em>y</em> and matrix <em>X</em>.
        Notice that <em>y</em> and <em>X</em> are left unchanged. In other
        words the additional column of ones for the intercept is not added. As
        default <tt>nocheck=0</tt>.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'bivarfit'</tt></td>
      <td bgcolor="#F2F2F2"><p>This option adds one or more least square lines,
        based on SIMPLE REGRESSION of y on Xi, to the plots of y|Xi. </p>

        <p><tt>bivarfit= ''</tt> is the default: no line is fitted. <br>
        <tt>bivarfit = '1'</tt> fits a single ols line to all points of each
        bivariate plot in the scatter matrix y|X. <br>
        <tt>bivarfit= '2'</tt> fits two ols lines: one to all points and
        another to the group of the genuine observations. The group of the
        potential outliers is not fitted. <br>
        <tt>bivarfit= '0'</tt> fits one ols line to each group. This is useful
        for the purpose of fitting mixtures of regression lines. <br>
        <tt>bivarfit= 'i1' or 'i2' or 'i3'</tt> etc. fits an ols line to a
        specific group, the one with index 'i' equal to 1, 2, 3 etc. Again,
        useful in case of mixtures.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'multivarfit'</tt></td>
      <td bgcolor="#F2F2F2"><p>This option adds one or more least square lines,
        based on MULTIVARIATE REGRESSION of y on X, to the plots of y|Xi. </p>

        <p><tt>multivarfit= ''</tt> is the default: no line is fitted. <tt><br>
        multivarfit = '1'</tt> fits a single ols line to all points of each
        bivariate plot in the scatter matrix y|X. The line added to the scatter
        plot y|Xi is avconst + Ci*Xi, where Ci is the coefficient of Xi in the
        multivariate regression and avconst is the effect of all the other
        explanatory variables different from Xi evaluated at their centroid
        (that is overline{y}'C)) <tt><br>
        multivarfit = '2'</tt> equal to <tt>multivarfit='1'</tt> but this time
        we also add the line based on the group of unselected observations
        (i.e. the normal units). </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'labeladd'</tt></td>
      <td bgcolor="#F2F2F2"><p>If this option is '1', we label the outliers
        with the unit row index in matrices <em>X</em> and <em>y</em>. The
        default value is <tt>labeladd=''</tt>, i.e. no label is added.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'nameX'</tt></td>
      <td bgcolor="#F2F2F2"><p>Cell array of strings of length p containing the
        labels of the variables of the regression dataset. If it is empty
        (default) the sequence X1, ..., Xp will be created automatically</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2" style="height: 32px"><tt>'namey'</tt></td>
      <td bgcolor="#F2F2F2" style="height: 32px"><p>Character containing the
        label of the response.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'ylim'</tt></td>
      <td bgcolor="#F2F2F2"><p>Vector with two elements controlling minimum and
        maximum on the y axis. Default value is '' (automatic scale)</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2" style="height: 32px"><tt>'xlim'</tt></td>
      <td bgcolor="#F2F2F2" style="height: 32px"><p>Vector with two elements
        controlling minimum and maximum on the x axis. Default value is ''
        (automatic scale)</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'bonflev'</tt></td>
      <td bgcolor="#F2F2F2"><p>option to be used if the distribution of the
        data is strongly non normal and, thus, the general signal detection
        rule based on consecutive exceedances cannot be used. In this case
        bonflev can be: <br>
        - a scalar smaller than 1 which specifies the confidence level for a
        signal and a stopping rule based on the comparison of the minimum
        deletion residual with a Bonferroni bound. For example if bonflev=0.99
        the procedure stops when the trajectory exceeds for the first time the
        99% bonferroni bound. <br>
        - A scalar value greater than 1.. In this case the procedure stops when
        the residual trajectory exceeds for the first time this value. <br>
        Default value is '', which means to rely on general rules based on
        consecutive exceedances. </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'msg'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar which controls whether to display or not
        messages on the screen If msg=1 (default) messages are displayed on the
        screen about step in which signal took place and .... else no message
        is displayed on the screen </p>
      </td>
    </tr>
  </tbody>
</table>

<p></p>
<a name="bq9x7hn"></a><a name="bq5gf2y"></a> 

<h3>Examples</h3>

<h3>Example 1</h3>
Let us consider some simulated data consisting of 100 observations and 3
explanatory variables. In order to replicate the results let us consider a
fixed seed. 
<pre class="programlisting">state=100;
randn('state', state);
n=100;
X=randn(n,3);
bet=[3;4;5];
y=3*randn(n,1)+X*bet;
y(1:20)=y(1:20)+13;
[outFS]=FSR(y,X,'plots',2);</pre>
The envelopes based on all the observations show that in the central part of
the search the observed curve is well beyond the extreme thresholds. More
precisely, the message inside the graph informs that the signal took place in
step 81 because the value of minimum deletion residual in this step was greater
than 99.999% threshold.

<p><img alt="" src="plots/fsr.ht1.gif"> </p>

<p> </p>

<p>Once a signal takes place the envelopes are resuperimposed until a stopping
rule is fulfilled.</p>

<p><img alt="" src="plots/fsr.ht2.gif"></p>
<img src="plots/fsr.ht3.gif"> 

<p>The procedure of resuperimposing envelopes in this case stops when n = 85,
the first time in which we have a value of <em>r</em><sub>min</sub>(m) for
n&gt;=m†-1 greater than the 99% threshold. The group can therefore be
considered as homogeneous up to when we include 84 units. </p>

<p>The below shows the final classification obtained by the forward search. The
units identified as outliers are shown in red circles. <img alt=""
src="plots/fsr.ht4.gif"></p>

<p>Figure below shows that among the 16 units declared as outliers belong to
the 20 units which had been previously contaminated.</p>

<p><img alt="" src="plots/fsr.ht5.gif"> </p>

<h3>Example 2</h3>

<p>If in the previous code we change the seed to 543 (state=543) we obtain the
following results:</p>

<p><img alt="" src="plots/fsr.ht6.gif"> <img alt="" src="plots/fsr.jpg"></p>

<p><img alt="" src="plots/fsr.ht8.gif"></p>

<p>In this second example 15 of the 20 units previously contaminated are
declared as outliers.</p>

<p><img alt="" src="plots/fsr.ht9.gif"> </p>

<p>If you wish to compare the output which comes out from the application of
the forward search estimator with that which comes from the application of
traditional robust estimators, please see page <a
href="lxs.html">lxs.html</a>.</p>

<h3>See Also</h3>

<p><a href="fsreda.html"><tt>FSReda</tt></a>, <a
href="lxs.html"><tt>LXS</tt></a></p>


<p></p>

<table border="0" cellpadding="0" cellspacing="0" class="nav"
summary="Navigation aid" width="100%">
  <tbody>
    <tr valign="top">
      <td align="left" width="20"><a href="fsmtra.html"><img align="bottom"
        alt="fsmtra" border="0" src="images_help/b_prev.gif"></a> </td>
      <td align="left">fsmtra.html</td>
      <td> </td>
      <td align="right">fsraddt.html</td>
      <td align="right" width="20"><a href="fsraddt.html"><img align="bottom"
        alt="FSRaddt" border="0" src="images_help/b_next.gif"></a></td>
    </tr>
  </tbody>
</table>
<script type="text/javascript" language="javaScript">
document.write(barra);</script>
<!-- Last updated: Fri Jan 23 17:00:05 EST 2009-->
</body>
</html>
