<html>
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <title>logmvnpdfFS: Functions (Flexible Statistics Data Analysis
  Toolbox™)</title>
  <link href="docstyle.css" rel="stylesheet" type="text/css">
  <meta content="refpage" name="chunktype">
  <meta content="function:logmvnpdfFS" name="refentity">
  <meta content="text/javascript" http-equiv="Content-Script-Type">
  <meta content="fcn" name="toctype">
  <script type="text/javascript" language="javaScript" src="bottom.js">
 </script>
</head>

<body>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<!--FScategory:Utilities-->
<a name="top_of_page"></a> 

<p style="font-size: 1px;"> </p>

<table border="0" cellpadding="0" cellspacing="0" class="nav"
summary="Navigation aid" width="100%">
  <tbody>
    <tr>
      <td valign="baseline"><b>Flexible Statistics Data Analysis
      Toolbox™</b></td>
      <td align="right" valign="baseline"><a href="lga.html"><img
        align="bottom" alt="fanplot" border="0"
        src="images_help/b_prev.gif"></a>   <a href="lxs.html"><img
        align="bottom" alt="FSMeda" border="0"
      src="images_help/b_next.gif"></a></td>
    </tr>
  </tbody>
</table>


<h1 class="reftitle">logmvnpdfFS</h1>

<p></p>

<p class="purpose">log of Multivariate normal probability density function
(pdf)</p>

<p>This function is a much faster version than (log of) Matlab function
mvnpdf</p>

<h2>Syntax </h2>

<p class="synopsis"><tt>y = logmvnpdfFS(X,Mu,Sigma)<br>
y = logmvnpdfFS(X,Mu,Sigma,X0,eyed,n,d)<br>
</tt></p>

<h2>Description </h2>

<p><tt>y = logmvnpdfFS(X,Mu,Sigma)</tt> returns the log-density of the
multivariate normal distribution with mean Mu and covariance Sigma, evaluated
at each row of X. This syntax uses matlab function bsxfun to compute the
deviations form the means and no mex function.</p>

<p> </p>

<p><tt>y = logmvnpdfFS(X,Mu,Sigma,X0,eyed,n,d)</tt> must be used if logmvnpdfFS
is repeatedly called. This sintax uses to compute the deviations from the means
a mex function obtained using C code DfM.c In this case X0 is another matrix of
the same size of X, eyed is an identity matrix of size length(Mu), n is a
scalar associated to the number of rows of X and d is a scalar associated with
the number of columns of X. </p>

<p>The details are as follows: in order to compute the kernel of the quadratic
form at the exponent logmvnpdfFS creates an identity of size length(Mu) and
similarly needs to compute length(Mu). These two quantites can be precalculated
and supplied as input parameters. If logmvnpdfFS has to be called thousands of
times (as it happens for example in each iteration of all procedures of cluster
analysis based mixtures of multivariate gaussian distributions). The same
argument above applies to scalars n and d which are directly passed to the
compiled mex function. </p>

<p> </p>

<h2>Examples</h2>

<p>In the examples below we compare the speed of the different solutions.</p>

<h3>Example 1</h3>

<p>In this example we check the agreement of the results with MATLAB function
mvnpdf</p>
<pre class="programlisting">     n=20000;
     X=randn(n,2);
     mu = [1 -1]; Sigma = [.9 .4; .4 .3];
     y = logmvnpdfFS(X, mu, Sigma);
     y1=log(mvnpdf(X,mu,Sigma));
     max(abs(y-y1))</pre>

<p></p>

<h3>Example 2</h3>

<p>TIME COMPARISON USING TIC TOC <br>
logmvnpdfFS with mex function and logmvnpdfFS without mex function </p>
<pre class="programlisting">    % In this code computation time is based on tic toc combined with a series
    % of replications

    % nn = sample size
    % vv = number of variables
    nn=[100 200 500 1000 5000 10000 50000 100000];
    vv=[2 5 10 20];

    % rep =number of replications
    rep = 1000;

    ttMat=nan(length(nn) , length(vv));
    ttFSwithMex=ttMat;
    ttFSnoMex=ttMat;


    Mat=0; tMat=0;
    FSwithmex=0; tFSwithMex=0;
    FSnoMex=0; tFSnoMex=0;


    in = 1; iv=1;
    for n = nn
        for v = vv

            X0 = zeros(n,v);
            eyed=eye(v);

            for i=1:rep

                X = randn(n,v);
                Mu = randn(1,v);
                Sigma=cov(X);

                %  Matlab function mvnpdf, (black line in plot)
                Mat = tic;
                y0 = mvnpdf(X, Mu, Sigma);
                y0=log(y0);
                tMat = tMat + toc(Mat);

                % logmvnpdfFS using mex file for mean deviations, (blue line in plot)
                FSwithmex = tic;
                yD = logmvnpdfFS(X, Mu, Sigma,X0,eyed,n,v);
                tFSwithMex = tFSwithMex + toc(FSwithmex);

                % logmvnpdfFS and no mex file for mean deviations. (red line in plot)
                FSnoMex = tic;
                yI = logmvnpdfFS(X, Mu, Sigma);
                tFSnoMex = tFSnoMex + toc(FSnoMex);


                if (sum(sum(abs(y0-yD))))&gt;10^-6  || (sum(sum(abs(y0-yI)))) &gt;10^-6
                   error('Difference in results: stop');
                end

            end

            ttMat(in,iv) = tMat;
            ttFSwithMex(in,iv) = tFSwithMex;
            ttFSnoMex(in,iv) = tFSnoMex;

            Mat=0; tMat=0;
            FSwithmex=0; tFSwithMex=0;
            FSnoMex=0; tFSnoMex=0;


            disp(['n=' num2str(n) ' -- v=' num2str(v)]);
            iv = iv+1;

        end
        in = in+1;
        iv = 1;
    end


    % Plotting part
    a=ver;
    a=a.Release;
    aa=1;
    bb=8;

    for ij=1:length(vv);
        subplot(length(vv)/2,2,ij)
        hold('on')
        plot(nn(aa:bb)',ttMat(aa:bb,ij),'k');
        plot(nn(aa:bb)',ttFSwithMex(aa:bb,ij),'b')
        plot(nn(aa:bb)',ttFSnoMex(aa:bb,ij),'r');

        if ij==1
            title(['v (number of variables)=' num2str(vv(ij)) ' version' a])
        else
            title(['v=' num2str(vv(ij))])
        end
        ylabel('Seconds')
        xlabel('Number of observations')
        if ij==4
            legend('mvnpdf','FS+mex','FS','location','NorthWest')
        end
    end

    hold off;</pre>

<p><img alt="" src="images_help/img12.jpg"></p>

<p> </p>

<h3>Example 3</h3>

<p>TIME COMPARISON USING TIMEIT FUNCTION<br>
 <em>Remark</em>: this function is present from MATLAB 2013b</p>

<p> </p>
<pre class="programlisting">    % nn = sample size
    % vv = number of variables
    nn=[100 200 500 1000 5000 10000 50000 100000];
    vv=[2 5 10 20];

    ttMat=nan(length(nn) , length(vv));
    ttFSwithMex=ttMat;
    ttFSnoMex=ttMat;

    in = 1; iv=1;
    for n = nn
        for v = vv

            X0 = zeros(n,v);
            eyed=eye(v);


            X = randn(n,v);
            Mu = randn(1,v);
            Sigma=cov(X);

            %  Matlab function mvnpdf
            yMat = @() log(mvnpdf(X, Mu, Sigma));
            tMat = timeit(yMat);


            % logmvnpdfFS using mex file for mean deviations. 
            yFSwithMex = @() logmvnpdfFS(X, Mu, Sigma,X0,eyed,n,v);
            tFSwithMex = timeit(yFSwithMex);

            % logmvnpdfFS and no mex file for mean deviations. 
            yFSnoMex = @() logmvnpdfFS(X, Mu, Sigma);
            tFSnoMex = timeit(yFSnoMex);

            ttMat(in,iv) = tMat;
            ttFSwithMex(in,iv) = tFSwithMex;
            ttFSnoMex(in,iv) = tFSnoMex;

            disp(['n=' num2str(n) ' -- v=' num2str(v)]);
            iv = iv+1;

        end
        in = in+1;
        iv = 1;
    end


    %% Plotting part
    a=ver;
    a=a.Release;
    aa=1;
    bb=length(nn);

    for ij=1:length(vv);
        subplot(length(vv)/2,2,ij)
        hold('on')
        plot(nn(aa:bb)',ttMat(aa:bb,ij),'k');
        plot(nn(aa:bb)',ttFSwithMex(aa:bb,ij),'b')
        plot(nn(aa:bb)',ttFSnoMex(aa:bb,ij),'r');

        if ij==1
            title(['v (number of variables) =' num2str(vv(ij)) ' version' a])
        else
            title(['v=' num2str(vv(ij))])
        end
        xlabel('Number of observations')

        if ij==4
            legend('mvnpdf','FS+mex','FS','location','NorthWest')
        end

    end

    hold off;</pre>

<p> </p>

<p><img alt="" src="images_help/img1E.jpg"><br>
<br>
</p>

<h3>See Also</h3>

<p><tt><a href="mvnpdf.html">mvnpdf</a> </tt> </p>


<p></p>

<table border="0" cellpadding="0" cellspacing="0" class="nav"
summary="Navigation aid" width="100%">
  <tbody>
    <tr valign="top">
      <td align="left" width="20"><a href="lga.html"><img align="bottom"
        alt="fanplot" border="0" src="images_help/b_prev.gif"></a> </td>
      <td align="left">lga.html</td>
      <td> </td>
      <td align="right">lxs.html</td>
      <td align="right" width="20"><a href="lxs.html"><img align="bottom"
        alt="FSMeda" border="0" src="images_help/b_next.gif"></a></td>
    </tr>
  </tbody>
</table>
<script type="text/javascript" language="javaScript">
document.write(barra);</script>
<!-- Last updated: Fri Jan 23 17:00:05 EST 2009-->
</body>
</html>
