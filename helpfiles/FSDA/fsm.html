<html>
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <title>FSM :: Functions (Flexible Statistics Data Analysis Toolbox™)</title>
  <link href="docstyle.css" rel="stylesheet" type="text/css">
  <meta content="refpage" name="chunktype">
  <meta content="function:FSM" name="refentity">
  <meta content="text/javascript" http-equiv="Content-Script-Type">
  <meta content="fcn" name="toctype">
  <script type="text/javascript" language="javaScript" src="bottom.js">
  </script>
</head>

<body>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<!--FScategory:Robust multivariate analysis and transformations-->
<a name="top_of_page"></a> 

<p style="font-size: 1px;"> </p>

<table border="0" cellpadding="0" cellspacing="0" class="nav"
summary="Navigation aid" width="100%">
  <tbody>
    <tr>
      <td valign="baseline"><b>Flexible Statistics Data Analysis
      Toolbox™</b></td>
      <td align="right" valign="baseline"><a href="fscolors.html"><img
        align="bottom" alt="fanplot" border="0"
        src="images_help/b_prev.gif"></a>   <a href="fsmbbm.html"><img
        align="bottom" alt="FSMeda" border="0"
      src="images_help/b_next.gif"></a></td>
    </tr>
  </tbody>
</table>

<a name="bq24of9-1"></a><a class="indexterm" name="zmw57dd0e69698"></a> 

<h1 class="reftitle">FSM</h1>

<p class="purpose">Automatic Outlier Detection Procedure based on Forward
Search Estimator </p>

<h2>Syntax </h2>

<p class="synopsis"><tt>[out] = FSM(Y)<br>
[out] =
FSM(Y,<i>param1</i></tt><tt>,</tt><tt><i>val1</i><tt>,</tt><i>param2</i><tt>,</tt><i>val2</i><tt>,...)<br>
</tt></tt></p>
<a name="f4811966"></a> 

<h2>Description </h2>

<p><tt>FSM(Y)</tt> gives in structure out a set of units which can be
considered atypical. To detect outliers all methods compare selected distances
with a threshold. We examine the minimum Mahalanobis Distance among
observations that are not in the subset (say of size <em>m</em>). </p>

<p><img alt="" src="images_help/img140.gif"></p>

<p>If this ordered observation is an outlier relative to the other m
observations, this distance will be "large" compared with the maximum distance
of observations in the subset. In uncalibrated use of the minimum Mahalanobis
Distance to detect outliers the decision whether a difference in distances is
"large" is subjective, without reference to any null distribution. To calibrate
the forward search and so to provide an objective basis for decisions about the
number of outliers in a sample we have found the distribution of the minimum
Mahalanobis distance in the forward search. The output is a series of
theoretical simultaneous confidence bands (envelopes) associated to the
quantiles of the distribution of the Mahalanobis Distance. Finally we have
tried to calibrate the complete search in order to provide an outlier test of
ascertainable properties. </p>

<p>To use the envelopes in the forward search for outlier detection we
accordingly propose a two-stage process. In the first stage we run a search on
the data, monitoring the bounds for all n observations until we obtain a
"signal" indicating that observation m<sup>†</sup> therefore succeeding
observations, may be outliers, because the value of the statistic lies beyond
our threshold. In the second part we superimpose envelopes for values of n from
this point until the first time that we introduce an observation we recognize
as an outlier. The envelopes of minimum Mahalanobis Distance outside subset
consist roughly of two parts; a flat "central" part and a steeply curving
"final" part. Our procedure FSM for the detection of a signal takes account of
these two parts. </p>

<h4>Detection of a Signal </h4>

<p>Because we potentially make many comparisons, one for each value of m, the
form of our threshold needs to allow for simultaneity, so that we have a test
with size α for the presence of at least one outlier. In order to keep into
account simultaneity we envisage four conditions, the fulfillment of any one of
which leads to the detection of a signal. </p>

<p>In the central part of the search we require 3 consecutive values of (m,n)
above the 99.99% envelope or 1 above 99.999%; <br>
In the final part of the search we need two consecutive values of
<em>d</em><sub>min</sub>(m,n) above 99.9% and 1 above 99%; <br>
<em>d</em><sub>min</sub>(n-2,n)&gt;99.9% envelope; <br>
<em>d</em><sub>min</sub>(n-1,n)&gt;99% envelope. In this last case a single
outlier is detected and the procedure terminates. </p>

<p>The final part of the search is defined as: m &gt;= n-[
13,(n/200)<sup>0.5</sup>], </p>

<p></p>

<h4>Identification of Outliers</h4>

<p>Once a signal has been found we start superimposing 99% envelopes taking
n*=m<sup>†</sup>-1, m<sup>†</sup>, m<sup>†</sup>+1, ... until the final,
penultimate or antepenultimate value are above the 99% threshold or,
alternatively, we have a value of <em>d</em><sub>min</sub>(m,n*) for any
m&gt;m<sup>†</sup> which is greater than the 99.9% threshold. </p>

<p><tt>Y</tt> is a matrix of size <i>n</i>-by-<i>v</i> containing (in the
columns) the variables of the dataset</p>

<p><tt>[out] = FSM(Y)</tt> returns the following information </p>
<ul type="disc">
  <li><tt>out</tt> − A structure of additional statistics with the following
    fields. 
    <ul type="circle">
      <li><p><tt>outliers</tt> − <tt>k</tt>-by-1 vector containing the list
        of the units declared as outliers or NaN if the sample is considered
        homogeneous </p>
      </li>
      <li><p><tt>mmd</tt> − <tt>n-init</tt>-by-2 matrix. <br>
        1st col = fwd search index<br>
        2nd col = value of minimum Mahalanobis distance in each step of the fwd
        search</p>
      </li>
      <li><p><tt>Un</tt> − <tt>(n-init)</tt>-by-11 matrix which contains the
        unit(s) included in the subset at each step of the fwd search. <br>
        REMARK: in every step the new subset is compared with the old subset.
        Un contains the unit(s) present in the new subset but not in the old
        one.<br>
        Un(1,2) for example contains the unit included in step init+1.<br>
        Un(end,2) contains the units included in the final step of the
        search.</p>
      </li>
      <li><p><tt>nout</tt> − 2 x 5 matrix containing the number of times
        observed minimum Mahalanobis Distance went out of particular
        quantiles.<br>
        First row contains quantiles 1%, 99%, 99.9%, 99.99% and 99.999%. <br>
        Second row contains the counts of the exceedances </p>
      </li>
      <li>loc − 1 x v vector containing location of the data.</li>
      <li>cov − v x v robust estimate of covariance matrix.</li>
      <li>md − n x 1 vector containing the estimates of the robust
        Mahalanobis distances (in squared units). This vector contains the
        distances of each observation from the location of the data, relative
        to the scatter matrix cov
        <p></p>
      </li>
    </ul>
    <ul>
      <a name="zmw57dd0e69798"></a> </ul>
  </li>
</ul>

<p></p>

<p><tt>[out] = FSM(<i>Y,
param1</i></tt><tt>,</tt><tt><i>val1</i><tt>,</tt><i>param2</i><tt>,</tt><i>val2</i><tt>,...)</tt></tt>
specifies one or more of the name/value pairs described in the following
table.</p>

<table border="2" cellpadding="4" cellspacing="0" class="body">
  <colgroup><col width="21%">
    <col width="79%">
  </colgroup>
  <thead>
    <tr valign="top">
      <th bgcolor="#B2B2B2">Parameter</th>
      <th bgcolor="#B2B2B2">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr valign="top">
      <td bgcolor="#F2F2F2"><tt>'plots'</tt></td>
      <td bgcolor="#F2F2F2"><p>missing value scalar or structure specifying
        whether it is necessary to produce the plots of minimum Mahalanobis
        distance <br>
        If plots is a missing value or is a scalar equal to 0 no plot is
        produced <br>
        If plots is a scalar equal to 1 (default) the plot of minimum MD with
        envelopes based on n observations and the scatterplot matrix with the
        outliers highlighted is produced. <br>
        If plots is a scalar equal to 2 the additional plots of envelope
        resuperimposition are produced. <br>
        If plots is a structure it is possible to specify the following options
        below <br>
        ylim : vector with two elements controlling minimum and maximum on the
        y axis. Default value is '' (automatic scale) <br>
        xlim : vector with two elements controlling minimum and maximum on the
        x axis. Default value is '' (automatic scale) <br>
        labeladd : If this option is '1', we label the outliers with the unit
        row index in the spm. The default value is labeladd='', i.e. no label
        is added. <br>
        resuper : vector which specifies for which steps it is necessary to
        show the plots of resuperimposed envelopes if resuper is not supplied a
        plot of each step in which the envelope is resuperimposed is shown.
        Example if resuper =[85 87] plots of resuperimposed envelopes are shown
        at steps m=85 and m=87 <br>
        ncoord : scalar. If ncoord=1 plots are shown in normal coordinates else
        (default) plots are shown in traditional mmd coordinates<br>nameY : cell 
	  array of strings containing the labels of the variables. As default value, 
	  the labels which are added are Y1, ...Yv.<br>lwd : Scalar which controls 
	  linewidth of the curves which contain the monitoring of minimum 
	  Mahalanobis distance. Default value of lwd=2 <br>lwdenv : Scalar which 
	  controls line width of the envelopes. Default value of lwdenv=2</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'m0'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar which specifies the initial subset size.
        The default is to start the search with v+1 units.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'crit'</tt></td>
      <td bgcolor="#F2F2F2"><p>String which specified the criterion to be used
        to initialize the search. If crit='md' the units which form initial
        subset are those which have the smallest m0 pseudo Mahalanobis
        distances computed using procedure unibiv (bivariate robust ellipses).
        If crit='biv' sorting is done first in terms of times units fell
        outside robust bivariate ellipses and then in terms of pseudoMD. In
        other words, the units forming initial subset are chosen first among
        the set of those which never fell outside robust bivariate ellipses
        then among those which fell only once outside bivariate ellipses ... up
        to reach m0. If crit='uni' sorting is done first in terms of times
        units fell outside univariate boxplots and then in terms of pseudoMD.
        In other words, the units forming initial subset are chosen first among
        the set of those which never fell outside univariate boxplots then
        among those which fell only once outside univariate boxplots... up to
        reach m0.<br>
        Remark: as the user can see the starting point of the search is not
        going to affect at all the results of the analysis. The user can
        explore this point with his own datasets Remark: if crit='biv' the user
        can also supply in scalar rf (see below) the confidence level of the
        bivariate ellipses.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'rf'</tt></td>
      <td bgcolor="#F2F2F2"><p>Confidence level for bivariate ellipses (default
        is 0.95). This option is useful only if crit='biv'.</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'init'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar which specifies the initial subset size
        to start monitoring exceedances. If init is not specified, it will be
        set equal to floor(n*0.6).</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'ylim'</tt></td>
      <td bgcolor="#F2F2F2"><p>Vector with two elements controlling minimum and
        maximum on the y axis. Default value is '' (automatic scale)</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'xlim'</tt></td>
      <td bgcolor="#F2F2F2"><p>Vector with two elements controlling minimum and
        maximum on the x axis. Default value is '' (automatic scale)</p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'msg'</tt></td>
      <td bgcolor="#F2F2F2"><p>Scalar which controls whether to display or not
        messages on the screen. If msg=1 (default) some messages, such as the
        steps in which signal took place, are displayed on the screen, else no
        message is displayed. </p>
      </td>
    </tr>
    <tr>
      <td bgcolor="#F2F2F2"><tt>'bonflev'</tt></td>
      <td bgcolor="#F2F2F2"><p>option to be used if the distribution of the
        data is strongly non normal and, thus, the general signal detection
        rule based on consecutive exceedances cannot be used. In this case
        bonflev can be: <br>
        - a scalar smaller than 1 which specifies the confidence level for a
        signal and a stopping rule based on the comparison of the minimum
        Mahalanobis distance residual with a Bonferroni bound. For example if
        bonflev=0.99 the procedure stops when the trajectory exceeds for the
        first time the 99% bonferroni bound. <br>
        - A scalar value greater than 1.. In this case the procedure stops when
        the residual trajectory exceeds for the first time this value. <br>
        Default value is '', which means to rely on general rules based on
        consecutive exceedances. </p>
      </td>
    </tr>
  </tbody>
</table>

<p></p>
<a name="bq9x7hn"></a><a name="bq5gf2y"></a> 

<h3>Examples</h3>

<h3>Example 1</h3>
Let us consider some simulated data consisting of 200 observations and 3
explanatory variables. In order to replicate the results let us consider a
fixed seed. 
<pre class="programlisting">state=100;
randn('state', state);
n=200;
Y=randn(n,3);
Ycont=Y;
Ycont(1:5,:)=Ycont(1:5,:)+3;
[out]=FSM(Ycont);</pre>
<pre class="programlisting"> </pre>
The envelopes based on all the observations show that in the f<span
class="style1">inal part of the search minimum Mahalanobis Distamce curve exits
from the envelopes.</span>

<p><img alt="" src="plots/fsm_es1_1.gif" height="400" width="426"> </p>

<p> Once a signal takes place the envelopes are resuperimposed until a
stopping rule is fulfilled./p&gt; </p>

<p><span class="style1"><img alt="" src="plots/fsm_es1_2.gif" height="420"
width="560"></span> </p>
<img alt="" src="plots/fsm_es1_3.gif" height="420" width="560"> 

<p>The procedure of resuperimposing envelopes in this case stops when n = 85,
the first time in which we have a value of <em>d</em><sub>min</sub>(m) for
n&gt;=m†-1 greater than the 99% threshold. The group can therefore be
considered as homogeneous up to when we include 84 units. </p>

<p>The below shows the final classification obtained by the forward search. The
units identified as outliers are shown in red circles.</p>

<p><span class="style1"><img alt="" src="images_help/img32.gif"></span></p>

<p>Figure below shows that among the 5 units declared as outliers 4 belong to
the 5 units which had been previously contaminated.</p>

<p></p>

<p><span class="style1"><img alt="" src="images_help/img2E.gif"></span> </p>

<h3>Example 2</h3>

<p>If in the previous code we change the seed to 543 (state=543) we obtain the
following results:</p>

<p><img alt="" src="plots/fsm_es2_1.gif" height="398" width="426"> </p>

<p><img alt="" src="plots/fsm_es2_2.gif"> </p>

<p><img alt="" src="plots/fsm_es2_3.gif"> </p>

<p><img alt="" src="plots/fsm_es2_4.gif"> </p>
<br>
<img alt="" src="images_help/img38.gif"><br>
 

<p>In this second example 3 of the 5 units previously contaminated are declared
as outliers.</p>

<p><img alt="" src="images_help/img44.gif"> </p>

<h3>Example 3</h3>
 

<p>In this example we show the monitoring of the Minimum Mahalanobis Distance
for the last 100 observations in the Swiss banknotes dataset:  </p>
<pre class="programlisting">load('swiss_banknotes');
[out]=FSM(swiss_banknotes.data(101:200,:),'plots',1);</pre>

<p>The plot of the Minimum Mahalanobis Distance shows that there is a large
peak at m=85. The peak occurs because the outliers form a loose cluster. Note
that the plot goes outside the upper envelope when m is slightly less than 85.
This is because, if we have a sample of 85 observations from the normal
distribution, the last few distances will be relatively large and the envelope
will curve upwards as it does in the plots for m a little less than 100. In
fact the superimposition of envelopes from n=83 shows that there is no evidence
of any outliers when n=83, n=84 and n=85, but when n=86  we obtain clear
evidence of a single outlier with observation 86 well outside the 99%
envelope.</p>

<p><img alt="" src="plots/fsm_es3_2.gif" height="420" width="560"></p>

<p> </p>

<p><img alt="" src="images_help/img3C2.gif"></p>

<h3>Example 4</h3>
 

<p>In this example we show the FS, applied to a simulated dataset with 5
contaminated variables, starting from a subset composed with the 5 observations
with the smallest Mahalanobis Distance.</p>

<p></p>
<pre class="programlisting">n=100;
v=3;
Y=randn(n,v);
% Contaminated data
Ycont=Y;
Ycont(1:5,:)=Ycont(1:5,:)+3;
[out]=FSM(Ycont,'m0',5,'crit','md');</pre>

<p align="left"> </p>

<p><img alt="" src="plots/fsm_es4_1.gif" height="398" width="426"> </p>
<img alt="" src="plots/fsm_es4_2.gif" height="420" width="560"> 

<p></p>
<img alt="" src="plots/fsm_es4_3.gif" height="420" width="560">

<p></p>

<h3> </h3>

<h3> </h3>

<h3>See Also</h3>

<p><a href="fsmeda.html"><tt>FSMeda</tt></a> </p>


<p></p>

<table border="0" cellpadding="0" cellspacing="0" class="nav"
summary="Navigation aid" width="100%">
  <tbody>
    <tr valign="top">
      <td align="left" width="20"><a href="fscolors.html"><img align="bottom"
        alt="fanplot" border="0" src="images_help/b_prev.gif"></a> </td>
      <td align="left">fscolors.html</td>
      <td> </td>
      <td align="right">fsmbbm.html</td>
      <td align="right" width="20"><a href="fsmbbm.html"><img align="bottom"
        alt="FSMeda" border="0" src="images_help/b_next.gif"></a></td>
    </tr>
  </tbody>
</table>
<script type="text/javascript" language="javaScript">
document.write(barra);</script>
<!-- Last updated: Fri Jan 23 17:00:05 EST 2009-->
</body>
</html>
